<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Benchmark - async vs sync inside Worker</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 {
            color: #00d9ff;
        }
        a {
            color: #00d9ff;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #00d9ff;
            border: none;
            color: #1a1a2e;
            font-weight: bold;
        }
        button:hover {
            background: #00b8d9;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        #output {
            margin-top: 20px;
            padding: 20px;
            background: #16213e;
            border-radius: 4px;
            white-space: pre-wrap;
            min-height: 200px;
        }
        #output div {
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <p><a href="./">&larr; Back</a></p>
    <h1>Worker Benchmark</h1>
    <p>Tests async vs sync performance when running inside a Web Worker</p>
    <button id="run">Run Benchmark</button>
    <div id="output">Click "Run Benchmark" to start...</div>
    <script type="module">
        const output = document.getElementById('output');
        const runBtn = document.getElementById('run');

        function log(message) {
            const line = document.createElement('div');
            line.textContent = message;
            output.appendChild(line);
            console.log(message);
        }

        function formatResult(result) {
            log(`\n${result.name}`);
            log(`  Zip size: ${(result.zipSize / 1024).toFixed(2)} KB`);
            log('');
            log('  zip:');
            log(`    Async: ${result.zipAsync.toFixed(2)} ms/op`);
            log(`    Sync:  ${result.zipSync.toFixed(2)} ms/op`);
            log(`    Ratio: ${(result.zipAsync / result.zipSync).toFixed(2)}x (${result.zipAsync < result.zipSync ? 'async faster' : 'sync faster'})`);
            log('');
            log('  unzip:');
            log(`    Async: ${result.unzipAsync.toFixed(2)} ms/op`);
            log(`    Sync:  ${result.unzipSync.toFixed(2)} ms/op`);
            log(`    Ratio: ${(result.unzipAsync / result.unzipSync).toFixed(2)}x (${result.unzipAsync < result.unzipSync ? 'async faster' : 'sync faster'})`);
        }

        runBtn.addEventListener('click', () => {
            output.textContent = '';
            log('=== Worker Benchmark: async vs sync inside Worker ===');
            log('Running benchmarks in Worker thread...');
            runBtn.disabled = true;

            const worker = new Worker(new URL('./worker-bench.ts', import.meta.url), { type: 'module' });

            worker.onmessage = (e) => {
                const results = e.data;
                for (const result of results) {
                    formatResult(result);
                }
                log('\n=== Benchmark Complete ===');
                runBtn.disabled = false;
                worker.terminate();
            };

            worker.onerror = (err) => {
                log(`Error: ${err.message}`);
                runBtn.disabled = false;
                worker.terminate();
            };

            worker.postMessage('start');
        });
    </script>
</body>
</html>
